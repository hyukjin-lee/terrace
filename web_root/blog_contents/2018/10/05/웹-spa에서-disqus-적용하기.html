<h1 id="웹-spa에서-disqus-적용하기">[웹] SPA에서 Disqus 적용하기</h1>
<p>Single Page App(SPA)에서 Disqus를 적용해보면 글이 바뀌더라도 처음 로딩한 코멘트가 바뀌지 않고 그대로 있는 것을 볼 수 있습니다. 아래의 함수를 글이 바뀔 때마다 호출해야 합니다.</p>
<pre class="javascript"><code>// Below function is from https://solidfoundationwebdev.com/blog/posts/many-disqus-modules-on-a-single-page
// The function did not work well,
// so I have fixed something, and it works well now.

function initDisqus(shortname, identifier, title, url) {
  if(typeof(DISQUS) === &#39;undefined&#39;){
    (async () =&gt; {
      var vars_text = &quot;var disqus_shortname  = \&quot;&quot; + shortname  + &quot;\&quot;;\n&quot; + 
        &quot;var disqus_title      = \&quot;&quot; + title      + &quot;\&quot;;\n&quot; + 
        &quot;var disqus_identifier = \&quot;&quot; + identifier + &quot;\&quot;;\n&quot; +
        &quot;var disqus_url        = \&quot;&quot; + url        + &quot;\&quot;;\n&quot;;

      var vars_obj   = document.createElement(&quot;script&quot;);
      vars_obj.type  = &quot;text/javascript&quot;;
      vars_obj.async = true;
      vars_obj.text  = vars_text;
      (document.getElementsByTagName(&#39;head&#39;)[0] || document.getElementsByTagName(&#39;body&#39;)[0]).appendChild(vars_obj);

      var dsq = document.createElement(&#39;script&#39;);
      dsq.type = &#39;text/javascript&#39;;
      dsq.async = true;
      dsq.src = &#39;//&#39; + shortname + &#39;.disqus.com/embed.js&#39;;
      (document.getElementsByTagName(&#39;head&#39;)[0] || document.getElementsByTagName(&#39;body&#39;)[0]).appendChild(dsq);
    })();
  } else {
    // eslint-disable-next-line
    DISQUS.reset({
      reload: true,
      config: function() {
        this.page.identifier = identifier;
        this.page.url = url;
        this.page.title = title;
      }
    });
  }
}</code></pre>
<p>글을 로딩할 때마다 아래처럼 함수를 호출합니다.</p>
<pre class="javascript"><code>this.initDisqus(
  &#39;myeongjae&#39;,
  &#39;blog/2017/09/17/rob-pike의-프로그래밍-규칙-5가지/&#39;, // uri as an identifier
  &#39;[기술] Rob Pike의 프로그래밍 규칙 5가지&#39;,
  &#39;https://myeongjae.kim/blog/2017/09/17/rob-pike의-프로그래밍-규칙-5가지/&#39;
);</code></pre>
